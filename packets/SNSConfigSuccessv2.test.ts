import { assertEquals } from "$std/assert/mod.ts";
import { init } from "zstd_wasm";
import {
  decodeSNSConfigSuccessv2Payload,
  encodeSNSConfigSuccessv2Payload,
  SNSConfigSuccessv2Data,
} from "./SNSConfigSuccessv2.ts";
import { idStringToInt, typeStringToInt } from "../utils/config.ts";

await init();

// deno-fmt-ignore
const packets: [SNSConfigSuccessv2Data, Uint8Array][] = [
  [
    {
      type: typeStringToInt("main_menu")!,
      id: idStringToInt("main_menu")!,
      config: {"_ts":1675189870550,"news":{"offseason":{"texture":null,"link":"https://medium.com/echo-games-blog"},"sentiment":{"texture":"ui_mnu_news_latest","link":"https://medium.com/@EchoGames"}},"splash":{"offseason":{"texture":"ui_menu_splash_screen_poster_a_shutdown_clr","link":"http://bit.ly/3XRCIhD"},"season_07":{"texture":"ui_menu_splash_screen_poster_a_s7_clr","link":"https://medium.com/@EchoGames"}},"id":"main_menu","splash_version":8,"help_link":"https://readyatdawn.zendesk.com/hc/en-us","news_link":"https://medium.com/@EchoGames","discord_link":"https://discord.gg/ymAYmnZ","type":"main_menu"},
    },
    new Uint8Array([123,29,14,68,39,238,9,21,123,29,14,68,39,238,9,21,89,2,0,0,40,181,47,253,96,89,1,85,9,0,70,146,57,34,48,109,243,160,172,103,59,91,150,161,112,147,69,186,26,70,103,40,83,197,75,76,3,75,38,68,223,10,28,44,12,12,214,1,48,0,46,0,48,0,41,41,103,254,223,170,133,52,140,139,98,172,173,150,105,125,8,254,141,168,237,233,140,253,241,152,27,81,235,13,247,34,5,131,161,80,26,3,141,5,67,17,88,168,245,95,27,9,145,241,69,207,179,9,243,53,4,130,125,231,103,113,121,195,189,106,203,5,235,126,179,132,223,236,139,158,93,102,116,36,156,37,91,18,243,53,78,114,182,68,86,232,88,6,15,107,27,50,185,106,29,84,20,197,234,233,236,224,41,24,44,48,4,36,39,38,15,29,41,41,26,219,234,102,186,175,207,23,91,148,223,39,179,154,153,54,95,171,54,63,103,1,0,15,51,206,47,90,135,150,13,5,210,73,203,146,56,58,155,67,183,104,189,38,154,83,123,16,103,215,28,145,116,195,220,51,199,49,166,139,137,252,22,53,212,246,132,78,57,24,0,112,230,132,206,204,74,69,199,48,3,188,203,0,173,8,108,239,156,146,123,5,44,219,237,218,72,108,113,157,214,58,152,217,14,196,240,14,13,76,0,111,30,109,88,237,65,58,166,72,98,180,96,101,204,3,91,112,193,48,204,28,193,12])
  ],
  [
    {
      type: typeStringToInt("active_battle_pass_season")!,
      id: idStringToInt("battle_pass_season_00_invalid")!,
      config: {"learn_more_link":null,"archives":{"marketing_menu":null,"marketing_lobby":null},"id":"battle_pass_season_00_invalid","offseason":false,"days_remaining_to_trigger_upsell":0,"ui":{"offseason_start_date_text":"INVALID","offseason_tier_unlocked_text":"INVALID","season_progression_upsell_text":"INVALID","season_track_header_text_upsell":"INVALID","icon_texture_texture":null,"offseason_time_to_next_season_text":"INVALID","season_track_header_text_start":"INVALID"},"premium_price":{"echopoints":0},"bp_xp_boost_reward_solo":0,"bp_currency_rewards":null,"premium_skus":null,"tier_rewards":null,"marketing":{"menu_season_panel_upsell_texture":null,"lobby_poster_upsell_texture":null,"lobby_poster_start_texture":null,"menu_season_panel_start_texture":null},"bp_xp_results":{"win":0,"loss":0},"bp_xp_requirements":{"use_constant_tier_xp_requirements":true,"constant_tier_xp_requirements":0,"variable_tier_xp_requirements":null},"season_number":0,"tier_price":{"echopoints":0},"menu_link_upsell":"https://bit.ly/3y79nDp","_ts":1621270670491,"description":null,"menu_link":"https://bit.ly/3y79nDp","bp_xp_boost_reward_party":0,"title":"Echo Pass: Invalid","type":"active_battle_pass_season"},
    },
    new Uint8Array([126,199,69,80,149,19,78,121,74,36,67,214,44,229,198,199,163,4,0,0,40,181,47,253,96,163,3,173,15,0,102,30,85,33,48,141,219,136,214,32,101,114,136,178,30,18,136,217,52,13,153,105,122,165,119,68,33,171,140,158,59,16,9,3,3,149,17,73,0,74,0,73,0,14,94,222,116,180,209,159,108,78,81,87,217,64,215,104,172,83,174,89,149,17,94,92,22,228,229,169,142,238,201,80,213,127,50,135,174,217,83,38,15,195,44,213,88,29,116,240,190,66,58,157,147,160,115,141,236,35,117,158,162,84,99,116,16,94,133,218,203,65,238,84,117,146,232,180,117,180,217,41,147,143,80,198,245,168,142,118,235,198,43,109,107,147,250,64,72,202,126,94,235,174,237,88,205,176,81,72,90,138,27,182,238,99,2,99,1,193,129,129,113,232,62,66,31,245,179,193,239,124,71,9,186,109,167,44,232,148,82,103,13,91,29,142,237,199,245,24,167,104,235,127,206,119,94,9,213,219,73,212,209,222,246,160,237,75,241,66,188,106,174,253,190,24,62,12,179,148,82,78,214,88,27,196,253,73,172,221,45,33,99,150,90,142,77,39,132,54,190,175,197,32,139,64,198,156,50,89,208,249,243,46,182,30,73,79,130,78,211,54,11,0,147,67,141,236,167,60,116,202,158,103,4,32,247,108,8,88,143,164,112,232,84,253,243,157,140,215,62,219,78,174,205,41,138,131,130,101,97,176,44,6,20,3,6,10,116,254,120,202,177,4,62,88,60,4,137,71,9,252,50,137,4,114,246,255,56,116,16,94,213,202,56,141,85,49,185,157,145,83,150,62,32,32,130,3,153,173,7,57,36,175,44,144,18,108,207,222,138,18,123,100,97,213,128,61,52,224,145,73,5,182,224,237,130,228,129,93,171,158,29,180,226,2,101,213,158,166,80,39,128,69,84,63,181,231,164,27,1,113,99,28,173,8,208,64,61,1,88,15,74,8,123,95,96,186,96,126,13,39,70,128,229,172,179,73,211,131,23,52,88,192,162,129,75,27,184,235,217,36,96,115,114,255,244,59,230,6,185,49,6,32,64,93,8,90,38,240,147,4,40,194,35,212,96,192,139,6,29,160,76,128,106,211,181,128,221,156,140,6,128,209,83,154,227,99,0,177,247,96,104,245,241,233,182,83,136,9,5])
  ],
  [
    {
      type: typeStringToInt("active_store_entry")!,
      id: idStringToInt("store_entry_0036")!,
      config: {"entry_number":36,"marketing":{"menu_store_panel_start_texture":"ui_mpl_menu_store_entry_0036","menu_store_panel_upsell_texture":"ui_mpl_menu_store_entry_0036_upsell","lobby_poster_upsell_texture":"ui_mpl_poster_store_entry_0036_upsell_emi","lobby_poster_start_texture":"ui_mpl_poster_store_entry_0036_emi"},"ui":{"store_panel_header_start_text":"ITEM INFO","store_panel_header_upsell_text":"ITEM INFO | GONE SOON!"},"type":"active_store_entry","store_slots":[{"reward_items":[{"bundle":{"sku":"store_rwd_chassis_trex_s1_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_trex_s1_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_trex_s1_a"},{"bundle":{"sku":"store_rwd_chassis_anubis_s2_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_anubis_s2_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_anubis_s2_a"},{"bundle":{"sku":"store_rwd_bracer_trex_s1_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_trex_s1_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_trex_s1_a"},{"bundle":{"sku":"store_rwd_bracer_anubis_s2_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_anubis_s2_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_anubis_s2_a"},{"bundle":{"sku":"store_rwd_booster_trex_s1_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_trex_s1_a","price":{"echopoints":50}},"reward_id":"rwd_booster_trex_s1_a"},{"bundle":{"sku":"store_rwd_booster_anubis_s2_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_anubis_s2_a","price":{"echopoints":50}},"reward_id":"rwd_booster_anubis_s2_a"}],"bundle_icon":null,"bundle_name":"SEASON 1 | SEASON 2","bundle_allow_individual_item_purchases":true,"bundle_description":null},{"reward_items":[{"bundle":{"sku":"store_rwd_chassis_samurai_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_samurai_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_samurai_a"},{"bundle":{"sku":"store_rwd_chassis_funk_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_funk_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_funk_a"},{"bundle":{"sku":"store_rwd_bracer_samurai_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_samurai_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_samurai_a"},{"bundle":{"sku":"store_rwd_bracer_funk_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_funk_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_funk_a"},{"bundle":{"sku":"store_rwd_booster_samurai_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_samurai_a","price":{"echopoints":50}},"reward_id":"rwd_booster_samurai_a"},{"bundle":{"sku":"store_rwd_booster_funk_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_funk_a","price":{"echopoints":50}},"reward_id":"rwd_booster_funk_a"}],"bundle_icon":null,"bundle_name":"SEASON 3 | SEASON 4","bundle_allow_individual_item_purchases":true,"bundle_description":null},{"reward_items":[{"bundle":{"sku":"store_rwd_chassis_wasteland_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_wasteland_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_wasteland_a"},{"bundle":{"sku":"store_rwd_chassis_shark_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_shark_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_shark_a"},{"bundle":{"sku":"store_rwd_bracer_wasteland_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_wasteland_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_wasteland_a"},{"bundle":{"sku":"store_rwd_bracer_shark_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_shark_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_shark_a"},{"bundle":{"sku":"store_rwd_booster_wasteland_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_wasteland_a","price":{"echopoints":50}},"reward_id":"rwd_booster_wasteland_a"},{"bundle":{"sku":"store_rwd_booster_shark_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_shark_a","price":{"echopoints":50}},"reward_id":"rwd_booster_shark_a"}],"bundle_icon":null,"bundle_name":"SEASON 5 | SEASON 6","bundle_allow_individual_item_purchases":true,"bundle_description":null}],"_ts":1675113432406,"days_remaining_to_trigger_upsell":3,"id":"store_entry_0036"},
    },
    new Uint8Array([201,45,66,236,171,86,219,89,18,160,208,17,242,100,196,193,71,17,0,0,40,181,47,253,96,71,16,37,23,0,198,91,82,34,64,139,219,224,11,149,182,132,245,242,64,240,44,100,69,234,73,228,249,120,158,111,223,108,141,126,252,35,200,226,85,148,1,11,68,0,75,0,73,0,49,213,148,237,184,29,59,195,143,36,149,60,79,212,82,101,107,252,82,84,233,48,203,162,77,114,218,49,87,178,71,232,192,80,161,47,124,109,252,86,82,246,8,190,198,199,46,39,43,31,175,33,51,248,186,84,14,179,210,249,113,241,169,196,225,227,156,4,82,170,100,186,138,120,117,96,135,250,253,191,16,72,89,196,87,70,6,110,236,197,199,49,108,101,190,17,246,156,36,172,124,24,181,231,134,134,208,230,74,150,36,48,213,148,1,140,70,195,161,44,24,141,2,229,65,81,217,32,96,24,40,7,11,4,131,92,201,150,33,57,89,217,1,16,200,163,164,109,35,235,134,102,175,53,18,181,182,153,80,30,20,132,194,104,56,6,22,142,92,201,110,95,107,241,173,124,17,212,170,20,166,166,105,34,199,25,90,127,18,175,223,79,124,171,166,204,149,172,173,243,232,165,154,166,69,129,88,249,240,117,36,69,16,136,161,246,0,83,58,204,178,40,235,84,204,202,199,163,29,106,4,245,241,250,245,58,118,125,201,178,84,206,162,72,48,10,6,129,104,4,28,77,165,224,52,77,211,56,190,144,103,111,27,195,223,136,130,105,26,134,23,23,122,61,186,125,53,53,148,218,161,103,198,209,225,202,231,223,128,176,168,113,26,145,9,70,68,130,4,73,146,36,173,1,64,66,66,144,148,219,28,18,168,192,152,32,8,113,16,66,208,65,16,66,136,33,78,64,4,73,73,129,16,51,51,65,134,139,1,134,151,0,28,93,250,222,56,72,68,77,91,166,30,142,120,175,137,0,192,191,224,46,89,194,81,188,5,210,59,250,36,11,4,97,33,34,110,91,146,184,1,63,108,61,0,186,239,239,151,15,71,119,36,228,243,112,15,26,171,232,63,248,154,24,162,118,213,9,48,212,106,225,32,17,159,127,254,160,226,208,153,146,122,254,179,187,134,68,161,183,120,30,86,146,11,59,15,142,171,199,213,5,56,36,170,46,234,217,209,209,234,163,240,97,127,97,61,126,244,47,32,11,79,29,230,21,136,1,228,119,74,73,35,216,193,45,249,209,87,191,21,125,37,221,6,242,82,239,96,239,164,182,155,18,145,3,156,82,62,209,47,159,31,240,68,151,43,38,62,243,90,121,192,16,79,5,122,254,76,82,209,81,168,123,214,160,78,101,245,104,224,249,174,146,174,252,77,142,196,88,40,118,56,232,81,200,185,128,201,248,124,116,7,2,183,163,201,74,6,189,132,121,136,174,147,14,241,10,196,24,74,60,81,210,115,16,66,212,226,39,25,217,14,160,136,205,138,38,104,80,137,76,71,189,196,140,103,1,182,6,152,137,147,165,75,20,78,173,105,241,3,145,113,117,169,168,8,153,116,92,213,12,143,30,162,69,127,164,162,7,211,104,10,37,85,123,10,103,76,79,72,244,166,99,17,101,194,105,169,95,15,166,227,131,48,197,172,129,61,87,82,218,204,96,3,245,207,172,20,229,22,205,213,156,81,52,178,56,81,123,8,25,201,26,163,2,66,82,6,101,37,101,146,245,82,85])
  ],
  [
    {
      type: typeStringToInt("active_store_featured_entry")!,
      id: idStringToInt("store_featured_entry_0013")!,
      config: {"entry_number":13,"marketing":{"menu_store_panel_start_texture":"ui_mpl_menu_store_featured_entry_0013","menu_store_panel_upsell_texture":"ui_mpl_menu_store_featured_entry_0013_upsell","lobby_poster_upsell_texture":"ui_mpl_poster_store_featured_entry_0013_upsell_emi","lobby_poster_start_texture":"ui_mpl_poster_store_featured_entry_0013_emi"},"ui":{"store_panel_header_start_text":"SEASON 7","store_panel_header_upsell_text":"FEATURED ITEM INFO | GONE SOON!"},"type":"active_store_featured_entry","store_slots":[{"reward_items":[{"bundle":{"sku":"store_rwd_chassis_noble_a_bundled","price":{"echopoints":140}},"normal":{"sku":"store_rwd_chassis_noble_a","price":{"echopoints":140}},"reward_id":"rwd_chassis_noble_a"},{"bundle":{"sku":"store_rwd_bracer_noble_a_bundled","price":{"echopoints":60}},"normal":{"sku":"store_rwd_bracer_noble_a","price":{"echopoints":60}},"reward_id":"rwd_bracer_noble_a"},{"bundle":{"sku":"store_rwd_booster_noble_a_bundled","price":{"echopoints":50}},"normal":{"sku":"store_rwd_booster_noble_a","price":{"echopoints":50}},"reward_id":"rwd_booster_noble_a"}],"bundle_icon":"ui_sto_feature_0008_clr","bundle_name":"SEASON 7","bundle_allow_individual_item_purchases":true,"bundle_description":null}],"_ts":1675113394826,"days_remaining_to_trigger_upsell":3,"id":"store_featured_entry_0013"},
    },
    new Uint8Array([49,249,210,18,177,34,73,85,237,192,93,221,189,140,180,85,39,5,0,0,40,181,47,253,96,39,4,221,14,0,6,26,79,37,16,143,86,7,145,184,151,148,124,162,143,137,208,165,31,169,119,95,227,197,1,62,38,118,254,19,63,247,64,0,102,187,170,170,234,96,4,64,0,74,0,66,0,146,82,158,7,186,171,59,183,81,154,234,78,195,48,218,182,167,100,43,161,78,138,148,231,215,183,167,180,88,169,178,153,140,234,246,49,73,183,161,140,58,223,70,175,172,75,30,203,157,104,22,93,57,205,122,239,19,205,167,148,150,111,95,9,172,173,89,197,246,43,16,235,81,66,23,151,130,37,196,190,190,18,69,94,77,15,120,64,32,145,197,241,128,40,44,23,11,36,225,177,176,48,56,28,22,22,4,71,195,131,195,129,35,65,157,96,121,64,34,7,142,200,215,27,219,201,43,235,60,175,166,115,180,28,109,175,140,48,111,7,105,1,195,48,10,101,124,16,98,85,17,19,131,1,27,189,16,235,71,77,255,122,115,44,106,248,174,166,137,25,104,214,163,124,12,37,56,129,22,226,150,174,222,148,233,186,7,62,141,28,35,155,64,218,42,122,125,78,172,107,111,62,209,202,0,83,227,43,103,93,34,225,150,10,165,74,30,63,102,209,182,70,10,107,87,13,129,130,1,3,199,105,26,6,65,67,175,34,38,231,230,91,127,144,165,196,13,197,109,59,91,174,199,141,108,2,245,148,212,177,217,152,130,219,99,173,128,206,177,141,216,11,61,32,32,130,227,164,156,7,192,116,160,135,12,210,181,152,130,109,61,119,186,77,100,45,147,246,46,63,3,251,36,201,138,70,119,8,25,17,228,208,116,102,3,208,14,80,142,55,24,146,144,1,252,236,86,130,14,216,233,110,226,223,193,46,4,9,3,240,2,33,66,134,94,205,237,171,44,191,152,17,41,17,43,2,22,26,144,9,100,216,68,212,28,151,146,89,168,173,164,49,179,20,144,47,9,64,247,14,94,46,64,187,128,155,254,27,28,234,121,0,124,195,87,141,193,182,6,86,209,240,8,224,156,128,248,0,113,6,16,120,32,159,75,151,173,26,35,200,232,161,231,144,201,50,84,20])
  ],
];

for (let i = 0; i < packets.length; i++) {
  const [data, payload] = packets[i];
  // FIXME: Client seems to like our responses, however our tests don't...
  // Since compression is wonky, we'll just make sure we can encode and decode into the same data
  // Deno.test(`encode SNSConfigSuccessv2 payload ${i}`, () =>
  //   assertEquals(
  //     decodeSNSConfigSuccessv2Payload(
  //       encodeSNSConfigSuccessv2Payload(data, true),
  //       true,
  //     ),
  //     data,
  //   ));

  Deno.test(`decode SNSConfigSuccessv2 payload ${i}`, () =>
    assertEquals(
      decodeSNSConfigSuccessv2Payload(payload, true),
      data,
    ));
}
